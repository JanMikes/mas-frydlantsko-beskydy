<div class="rozjizdeci-obsahy-component margin-component" data-controller="files-tag-filter">
    {% if data.Tagy|length > 1 %}
        <div class="mb-3">
            <button type="button"
                    class="button-style-filter me-2 mb-2"
                    data-files-tag-filter-target="allButton"
                    data-action="click->files-tag-filter#clearFilters">
                Všechny
            </button>
            {% for tag in data.Tagy %}
                {% if loop.index <= 5 %}
                    <button type="button"
                            class="button-style-filter me-2 mb-2"
                            data-files-tag-filter-target="filter"
                            data-tag="{{ tag.slug }}"
                            data-action="click->files-tag-filter#toggleFilter">
                        {{ tag.Tag }}
                    </button>
                {% endif %}
            {% endfor %}

            {% if data.Tagy|length > 5 %}
                <div class="d-none" data-files-tag-filter-target="hiddenTags">
                    {% for tag in data.Tagy %}
                        {% if loop.index > 5 %}
                            <button type="button"
                                    class="button-style-filter me-2 mb-2"
                                    data-files-tag-filter-target="filter"
                                    data-tag="{{ tag.slug }}"
                                    data-action="click->files-tag-filter#toggleFilter">
                                {{ tag.Tag }}
                            </button>
                        {% endif %}
                    {% endfor %}
                </div>

                <button type="button"
                        class="button-style-filter button-style-filter-inverse ms-2 mb-2"
                        data-files-tag-filter-target="showMoreButton"
                        data-action="click->files-tag-filter#showMoreTags">
                    <i class="bi bi-plus-circle"></i> Více
                </button>
            {% endif %}

            <a href="#"
               class="d-none ms-2 small text-decoration-underline"
               data-files-tag-filter-target="clearFiltersLink"
               data-action="click->files-tag-filter#clearFilters">
                zrušit filtrování
            </a>
        </div>
    {% endif %}

    {% for item in data.Polozky %}
        {% set collapseId = 'rozjizdeci-obsah-' ~ loop.index ~ '-' ~ random(1000000) %}
        {% set hasContent = item.hasCollapsibleContent() %}

        <div {% if item.Tagy %}data-tags="{{ item.Tagy|map(t => t.slug)|join(',') }}"{% endif %}
             data-files-tag-filter-target="item">
            {% if item.Nadpis %}
                <div class="rozjizdeci-obsah-nadpis mb-0 {{ hasContent ? 'collapse-toggle collapsed' : '' }} d-flex align-items-center justify-content-between w-100 {{ data.Styl == 'Styl 2' ? 'rozjizdeci-obsah-nadpis-style-2' }}" {% if hasContent %}data-bs-toggle="collapse" data-bs-target="#{{ collapseId }}" aria-expanded="false" aria-controls="{{ collapseId }}" style="cursor: pointer;"{% endif %}>
                    <h4 class="h6 mb-0">{{ item.Nadpis }}</h4>
                    {% if hasContent %}
                        <i class="bi bi-chevron-down"></i>
                    {% endif %}
                </div>
            {% endif %}

            <div id="{{ collapseId }}" class="collapse">
                <div class="rozjizdeci-obsah-content">
                    {% if item.Text %}
                        {% if item.Text.Nadpis %}
                            <h5 class="mt-0">{{ item.Text.Nadpis }}</h5>
                        {% endif %}

                        {% if item.Text and item.Text.Text %}
                            <div>
                                {{ item.Text.Text|markdown_to_html|newlines }}
                            </div>
                        {% endif %}
                    {% endif %}

                    {% if item.Lide %}
                        <div class="pt-3">
                            {{ component('Samosprava', {
                                data: item.Lide,
                                hasPanel: false,
                            }) }}
                        </div>
                    {% endif %}

                    {% if item.Dokumenty %}
                        <div class="pt-3">
                            {{ component('SouboryKeStazeni', {
                                data: item.Dokumenty,
                                hasPanel: false,
                            }) }}
                        </div>
                    {% endif %}

                    {% if item.Vyzva %}
                        <div class="pt-3">
                            <div class="vyzva-table">
                                {% if item.Vyzva.ZahajeniVyzvy %}
                                    <div class="vyzva-table-row"><strong>Zahájení výzvy:</strong> {{ item.Vyzva.ZahajeniVyzvy|date('d.m.Y H:i') }}</div>
                                {% endif %}

                                {% if item.Vyzva.ZahajeniPrijmuZadosti %}
                                    <div class="vyzva-table-row"><strong>Zahájení příjmu žádostí o podporu:</strong> {{ item.Vyzva.ZahajeniPrijmuZadosti|date('d.m.Y H:i') }}</div>
                                {% endif %}

                                {% if item.Vyzva.KonecVyzvy %}
                                    <div class="vyzva-table-row"><strong>Konec výzvy:</strong> {{ item.Vyzva.KonecVyzvy|date('d.m.Y H:i') }}</div>
                                {% endif %}

                                {% if item.Vyzva.FinancniAlokace %}
                                    <div class="vyzva-table-row"><strong>Finanční alokace:</strong> {{ item.Vyzva.FinancniAlokace|number_format(0, '', ' ') }} Kč</div>
                                {% endif %}

                                {% if item.Vyzva.MinimalniVyseNakladu %}
                                    <div class="vyzva-table-row"><strong>Minimální výše celkových způsobilých výdajů:</strong> {{ item.Vyzva.MinimalniVyseNakladu|number_format(0, '', ' ') }} Kč</div>
                                {% endif %}

                                {% if item.Vyzva.MaximalniVyseNakladu %}
                                    <div class="vyzva-table-row"><strong>Maximální výše celkových způsobilých výdajů na jeden projekt:</strong> {{ item.Vyzva.MaximalniVyseNakladu|number_format(0, '', ' ') }} Kč</div>
                                {% endif %}

                                {% if item.Vyzva.OpravneniZadatele %}
                                    <div class="vyzva-table-row">
                                        <strong>Opravnění žadatelé:</strong>
                                        {{ item.Vyzva.OpravneniZadatele|markdown_to_html|newlines }}
                                    </div>
                                {% endif %}
                            </div>

                            {% if item.Vyzva.Lide %}
                                <div class="vyzva-table-row">
                                    {{ component('Samosprava', {
                                        data: item.Vyzva.Lide,
                                        hasPanel: false,
                                    }) }}
                                </div>
                            {% endif %}

                            {% if item.Vyzva.Dokumenty %}
                                <div class="vyzva-table-row">
                                    {{ component('SouboryKeStazeni', {
                                        data: item.Vyzva.Dokumenty,
                                        hasPanel: false,
                                    }) }}
                                </div>
                            {% endif %}

                            <p class="button-style-2">
                                <a href="{{ path('detail_vyzvy', {'slug': item.Vyzva.slug}) }}">Detail výzvy <i class="bi-chevron-right"></i></a>
                            </p>
                        </div>
                    {% endif %}

                    {% if item.Tlacitko %}
                        <span class="d-inline-block my-2 {{ item.Tlacitko.Styl == 'Styl 1' ? 'button-style-1' : 'button-style-2' }}">
                            <twig:Odkaz data="{{ item.Tlacitko.Odkaz }}">{{ item.Tlacitko.Text }}{{ item.Tlacitko.Styl == 'Styl 2' ? ' &raquo;' }}</twig:Odkaz>
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endfor %}
</div>
