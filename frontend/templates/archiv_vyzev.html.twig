{% extends 'base.html.twig' %}

{% block title %}Archiv výzev{% endblock %}

{% block content %}
    <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ path('homepage') }}">Hlavní stránka</a></li>
            <li class="breadcrumb-item active" aria-current="page">Archiv výzev</li>
        </ol>
    </nav>

    <div class="container py-4">
        <h1 class="mb-5"><span class="heading-border">Archiv výzev</span></h1>

        <div class="rozjizdeci-obsahy-component margin-component" data-controller="files-tag-filter" data-files-tag-filter-auto-select-first-value="false">
            {% if kategorie|length > 1 %}
                <div class="mb-3">
                    <p class="mb-2">Filtrovat podle kategorie:</p>

                    <button type="button" class="button-style-filter me-1 me-md-2 mb-1 mb-md-2 active" data-files-tag-filter-target="allButton" data-action="click->files-tag-filter#clearFilters">
                        Všechny
                    </button>

                    {% for kategorieItem in kategorie %}
                        <button type="button" class="button-style-filter me-1 me-md-2 mb-1 mb-md-2" data-files-tag-filter-target="filter" data-tag="{{ kategorieItem.slug }}" data-filter-type="category" data-action="click->files-tag-filter#toggleFilter">
                            {{ kategorieItem.Nazev }}
                        </button>
                    {% endfor %}

                    <a href="#"
                       class="d-none ms-2 small text-decoration-underline"
                       data-files-tag-filter-target="clearFiltersLink"
                       data-action="click->files-tag-filter#clearFilters">
                        zrušit filtrování
                    </a>
                </div>
            {% endif %}

            {% if tags|length > 0 %}
                <hr>
                <div class="mb-3">
                    {% for tag in tags %}
                        <button type="button" class="button-style-filter me-1 me-md-2 mb-1 mb-md-2" data-files-tag-filter-target="filter" data-tag="{{ tag.slug }}" data-filter-type="tag" data-action="click->files-tag-filter#toggleFilter">
                            {{ tag.Tag }}
                        </button>
                    {% endfor %}
                </div>
            {% endif %}

            {% for vyzva in vyzvy %}
                {% set collapseId = 'rozjizdeci-obsah-' ~ loop.index ~ '-' ~ random(1000000) %}

                {% set kategorieSlugs = [] %}
                {% for kategorie in vyzva.Kategorie %}
                    {% set kategorieSlugs = kategorieSlugs|merge([kategorie.slug]) %}
                {% endfor %}

                {% set tagSlugs = [] %}
                {% for tag in vyzva.Tagy %}
                    {% set tagSlugs = tagSlugs|merge([tag.slug]) %}
                {% endfor %}

                {% set allSlugs = kategorieSlugs|merge(tagSlugs) %}

                <div class="d-block" data-files-tag-filter-target="item" data-tags="{{ allSlugs|join(',') }}">
                    {% if vyzva.Nazev %}
                        <div class="rozjizdeci-obsah-nadpis mb-0 collapse-toggle d-flex align-items-center justify-content-between collapsed w-100 rozjizdeci-obsah-nadpis-style-2" data-bs-toggle="collapse" data-bs-target="#{{ collapseId }}" aria-expanded="false" aria-controls="{{ collapseId }}" style="cursor: pointer;">
                            <h4 class="h6 mb-0">{{ vyzva.Nazev }}</h4>
                            <i class="bi bi-chevron-down"></i>
                        </div>
                    {% endif %}

                    <div id="{{ collapseId }}" class="collapse">
                        <div class="rozjizdeci-obsah-content">
                            <div class="pt-3">
                                <div class="vyzva-table">
                                    {% if vyzva.ZahajeniVyzvy %}
                                        <div class="vyzva-table-row"><strong>Zahájení výzvy:</strong> {{ vyzva.ZahajeniVyzvy|date('d.m.Y H:i') }}</div>
                                    {% endif %}

                                    {% if vyzva.ZahajeniPrijmuZadosti %}
                                        <div class="vyzva-table-row"><strong>Zahájení příjmu žádostí o podporu:</strong> {{ vyzva.ZahajeniPrijmuZadosti|date('d.m.Y H:i') }}</div>
                                    {% endif %}

                                    {% if vyzva.KonecVyzvy %}
                                        <div class="vyzva-table-row"><strong>Konec výzvy:</strong> {{ vyzva.KonecVyzvy|date('d.m.Y H:i') }}</div>
                                    {% endif %}

                                    {% if vyzva.FinancniAlokace %}
                                        <div class="vyzva-table-row"><strong>Finanční alokace:</strong> {{ vyzva.FinancniAlokace|number_format(0, '', ' ') }} Kč</div>
                                    {% endif %}

                                    {% if vyzva.MinimalniVyseNakladu %}
                                        <div class="vyzva-table-row"><strong>Minimální výše celkových způsobilých výdajů:</strong> {{ vyzva.MinimalniVyseNakladu|number_format(0, '', ' ') }} Kč</div>
                                    {% endif %}

                                    {% if vyzva.MaximalniVyseNakladu %}
                                        <div class="vyzva-table-row"><strong>Maximální výše celkových způsobilých výdajů na jeden projekt:</strong> {{ vyzva.MaximalniVyseNakladu|number_format(0, '', ' ') }} Kč</div>
                                    {% endif %}

                                    {% if vyzva.OpravneniZadatele %}
                                        <div class="vyzva-table-row">
                                            <strong>Opravnění žadatelé:</strong>
                                            {{ vyzva.OpravneniZadatele|markdown_to_html|newlines }}
                                        </div>
                                    {% endif %}
                                </div>

                                {% if vyzva.Lide %}
                                    <div class="vyzva-table-row">
                                        {{ component('Samosprava', {
                                            data: vyzva.Lide,
                                            hasPanel: false,
                                        }) }}
                                    </div>
                                {% endif %}

                                {% if vyzva.Dokumenty %}
                                    <div class="vyzva-table-row">
                                        {{ component('SouboryKeStazeni', {
                                            data: vyzva.Dokumenty,
                                            hasPanel: false,
                                        }) }}
                                    </div>
                                {% endif %}

                                <p class="button-style-2 mt-4">
                                    <a href="{{ path('detail_vyzvy', {'slug': vyzva.slug}) }}">Detail výzvy <i class="bi-chevron-right"></i></a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}

